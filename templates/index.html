<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Repozytorium Pocztówek</title>
    <style>
        /* (Te same style co wcześniej - skrócone dla czytelności) */
        :root { --primary-color: #2c3e50; --accent-color: #3498db; --bg-color: #f4f7f6; --card-bg: #ffffff; }
        body { font-family: sans-serif; background: var(--bg-color); color: #333; margin: 0; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }

        /* Header i Formularz */
        .search-box { background: var(--card-bg); padding: 20px; border-radius: 8px; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; margin-bottom: 20px;}
        input, select, button { padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
        button { background: var(--accent-color); color: white; border: none; cursor: pointer; }

        /* Tabela */
        .table-wrapper { background: var(--card-bg); border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); overflow-x: auto;}
        table { width: 100%; border-collapse: collapse; min-width: 800px; }
        th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #eee; vertical-align: middle; }
        th { background: var(--primary-color); color: white; }

        /* Klikalny wiersz */
        tr.clickable-row { cursor: pointer; transition: background 0.1s; }
        tr.clickable-row:hover { background-color: #eaf2f8; }

        /* Miniatury */
        .thumb-img {
            width: 120px;
            height: 120px;
            object-fit: contain; /* Zachowuje proporcje w kwadracie 120x120 */
            background: #eee;
            border-radius: 4px;
            display: block;
        }

        /* Badge */
        .badge { padding: 2px 8px; border-radius: 12px; font-size: 0.8em; font-weight: bold; }
        .badge-city { background: #e8f6f3; color: #1abc9c; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1 style="text-align:center; color:#2c3e50;">Repozytorium Pocztówek</h1>
        <form action="/" method="get" class="search-box">
            <input type="text" name="q" placeholder="Szukaj..." value="{{ search_query }}">
            <select name="publisher_id">
                <option value="">-- Dowolny wydawca --</option>
                {% for publisher in all_publishers %}
                    <option value="{{ publisher.id }}" {% if publisher.id == wydawca_filter %}selected{% endif %}>{{ publisher.name }}</option>
                {% endfor %}
            </select>
            <select name="city_id">
                <option value="">-- Dowolne miasto --</option>
                {% for city in all_cities %}
                    <option value="{{ city.id }}" {% if city.id == city_filter %}selected{% endif %}>{{ city.name }}</option>
                {% endfor %}
            </select>
            <select name="author_id">
                <option value="">-- Dowolny autor --</option>
                {% for author in all_authors %}
                    <option value="{{ author.id }}" {% if author.id == author_filter %}selected{% endif %}>{{ author.imie_nazwisko }}</option>
                {% endfor %}
            </select>
            <input type="number" name="year" placeholder="Rok" value="{{ year_filter }}" style="width: 80px;">
            <button type="submit">Szukaj</button>
            <a href="/" style="padding:10px; color:#777;">Reset</a>
        </form>
    </header>

    <div class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th style="width: 60px;">ID</th>
                    <th style="width: 140px;">Awers</th>
                    <th>Dane pocztówki</th>
                    <th>Wzór</th>
                </tr>
            </thead>
            <tbody>
                {% for p in pocztowki %}
                <tr class="clickable-row" onclick="window.location='/view/{{ p.id }}'">
                    <td>{{ p.id }}</td>
                    <td>
                        {% if p.awers_id %}
                            <img src="/images/{{ p.awers_id }}_mini.jpg" class="thumb-img" alt="Miniatura">
                        {% else %}
                            <div class="thumb-img" style="display:flex; align-items:center; justify-content:center; color:#999;">Brak</div>
                        {% endif %}
                    </td>
                    <td>
                        <div style="font-weight:bold; color:#2c3e50;">{{ p.miasto or "Nieznane miasto" }}</div>
                        <div style="font-size:0.9em; color:#555;">{{ p.opis_wzoru or "Brak opisu" }}</div>
                        {% if p.autor %}
                            <div style="font-size:0.8em;">Autor: {{ p.autor }}</div>
                        {% else %}
                            <div style="font-size:0.8em; color:#7f8c8d;">Autor Nieznany</div>
                        {% endif %}
                    </td>
                    <td>
                        <strong>{{ p.wzor_full }}</strong><br>
                        <span style="font-size:0.85em; color:#7f8c8d;">rok: {{ "Nieznany" if p.year == "0" else p.year }}</span>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

</body>
</html>